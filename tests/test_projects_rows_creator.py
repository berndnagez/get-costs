from src.get_costs import projects_rows_creator
from src.get_costs.date_creator import get_date_object
import datetime


def test_create_new_headline():
    all_rows = []
    project_id = '0005_Präv'
    date_object = get_date_object("24_01_23 Lohnjournal Januar 2024.xlsx")
    excepted_headline = [[('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'})], [('0005_Präv', {'bold': True, 'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'}), (datetime.date(2024, 1, 1), {'bold': True, 'num_format': 'mmm yyyy',
                                                                                                                                                                                                                                        'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'}), ('', {'bold': True, 'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'}), ('', {'bold': True, 'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'})]]
    returned_headline = projects_rows_creator.create_new_headline(
        project_id, date_object, all_rows)

    assert returned_headline == excepted_headline


def test_get_row():
    key = "Gehalt Björn"
    value = "=ROUND(-2297.29/24*20.0, 2)"
    excepted_row = [('Gehalt Björn', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]',
                                                                                                                                                                          'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-2297.29/24*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})]
    returned_row = projects_rows_creator.get_row(key, value)

    assert returned_row == excepted_row


def test_get_all_rows():
    splitted_values_list = [
        {'project_id': '0026_comM', 'Gehalt Björn': '=ROUND(-2297.29/24*20.0, 2)', 'Sozialv. Björn': '=ROUND(-469.79/24*20.0, 2)', 'Umlagen Björn': '=ROUND(-65.47/24*20.0, 2)',
         'bAV Björn': '=ROUND(-75.0/24*20.0, 2)', 'Edenred Björn': '=ROUND(-50.0/24*20.0, 2)', 'AU-Erstattung Björn': '=ROUND(237.23/24*20.0, 2)'},
        {'project_id': '0026_comM', 'Gehalt Alan': '=ROUND(-3675.67/40*20.0, 2)', 'Sozialv. Alan': '=ROUND(-749.47/40*20.0, 2)', 'Umlagen Alan': '=ROUND(-142.99/40*20.0, 2)',
         'bAV Alan': '=ROUND(-150.0/40*20.0, 2)', 'HVV Alan': '=ROUND(-46.55/40*20.0, 2)', '1&1 Alan': '=ROUND(-7.99/40*20.0, 2)', 'Edenred Alan': '=ROUND(-50.0/40*20.0, 2)'}
    ]
    date_object = get_date_object("24_01_23 Lohnjournal Januar 2024.xlsx")
    all_rows = []
    excepted_rows = {'COSTS_SHEET': [[('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'})], [('0026_comM', {'bold': True, 'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'}), (datetime.date(2024, 1, 1), {'bold': True, 'num_format': 'mmm yyyy', 'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'}), ('', {'bold': True, 'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'}), ('', {'bold': True, 'font_name': 'Arial', 'font_size': '10', 'bg_color': 'gray', 'align': 'left'})], [('Gehalt Björn', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-2297.29/24*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('Sozialv. Björn', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-469.79/24*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('Umlagen Björn', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-65.47/24*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('bAV Björn', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-75.0/24*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('Edenred Björn', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-50.0/24*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('AU-Erstattung Björn', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(237.23/24*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('Gehalt Alan', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-3675.67/40*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('Sozialv. Alan', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-749.47/40*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('Umlagen Alan', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-142.99/40*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('bAV Alan', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-150.0/40*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('HVV Alan', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-46.55/40*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('1&1 Alan', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-7.99/40*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})], [('Edenred Alan', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'font_name': 'Arial', 'font_size': '10', 'align': 'left'}), ('', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'}), ('=ROUND(-50.0/40*20.0, 2)', {'num_format': '#,##0.00 [$€-407];[Red]-#,##0.00 [$€-407]', 'font_name': 'Arial', 'font_size': '10', 'align': 'right'})]]}
    returned_rows = projects_rows_creator.get_all_rows(
        splitted_values_list, date_object, all_rows)

    assert excepted_rows == returned_rows
